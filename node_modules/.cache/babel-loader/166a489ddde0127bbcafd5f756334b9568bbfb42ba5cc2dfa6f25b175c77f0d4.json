{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { innerFrom } from '../observable/innerFrom';\nimport { executeSchedule } from '../util/executeSchedule';\nimport { createOperatorSubscriber } from './OperatorSubscriber';\nexport function mergeInternals(source, subscriber, project, concurrent, onBeforeNext, expand, innerSubScheduler, additionalFinalizer) {\n  var buffer = [];\n  var active = 0;\n  var index = 0;\n  var isComplete = false;\n  var checkComplete = function () {\n    if (isComplete && !buffer.length && !active) {\n      subscriber.complete();\n    }\n  };\n  var outerNext = function (value) {\n    return active < concurrent ? doInnerSub(value) : buffer.push(value);\n  };\n  var doInnerSub = function (value) {\n    expand && subscriber.next(value);\n    active++;\n    var innerComplete = false;\n    innerFrom(project(value, index++)).subscribe(createOperatorSubscriber(subscriber, function (innerValue) {\n      onBeforeNext === null || onBeforeNext === void 0 ? void 0 : onBeforeNext(innerValue);\n      if (expand) {\n        outerNext(innerValue);\n      } else {\n        subscriber.next(innerValue);\n      }\n    }, function () {\n      innerComplete = true;\n    }, undefined, function () {\n      if (innerComplete) {\n        try {\n          active--;\n          var _loop_1 = function () {\n            var bufferedValue = buffer.shift();\n            if (innerSubScheduler) {\n              executeSchedule(subscriber, innerSubScheduler, function () {\n                return doInnerSub(bufferedValue);\n              });\n            } else {\n              doInnerSub(bufferedValue);\n            }\n          };\n          while (buffer.length && active < concurrent) {\n            _loop_1();\n          }\n          checkComplete();\n        } catch (err) {\n          subscriber.error(err);\n        }\n      }\n    }));\n  };\n  source.subscribe(createOperatorSubscriber(subscriber, outerNext, function () {\n    isComplete = true;\n    checkComplete();\n  }));\n  return function () {\n    additionalFinalizer === null || additionalFinalizer === void 0 ? void 0 : additionalFinalizer();\n  };\n}","map":{"version":3,"names":["innerFrom","executeSchedule","createOperatorSubscriber","mergeInternals","source","subscriber","project","concurrent","onBeforeNext","expand","innerSubScheduler","additionalFinalizer","buffer","active","index","isComplete","checkComplete","length","complete","outerNext","value","doInnerSub","push","next","innerComplete","subscribe","innerValue","undefined","bufferedValue","shift","err","error"],"sources":["../../../../src/internal/operators/mergeInternals.ts"],"sourcesContent":[null],"mappings":";AACA,SAASA,SAAS,QAAQ,yBAAyB;AAGnD,SAASC,eAAe,QAAQ,yBAAyB;AACzD,SAASC,wBAAwB,QAAQ,sBAAsB;AAe/D,OAAM,SAAUC,cAAcA,CAC5BC,MAAqB,EACrBC,UAAyB,EACzBC,OAAwD,EACxDC,UAAkB,EAClBC,YAAsC,EACtCC,MAAgB,EAChBC,iBAAiC,EACjCC,mBAAgC;EAGhC,IAAMC,MAAM,GAAQ,EAAE;EAEtB,IAAIC,MAAM,GAAG,CAAC;EAEd,IAAIC,KAAK,GAAG,CAAC;EAEb,IAAIC,UAAU,GAAG,KAAK;EAKtB,IAAMC,aAAa,GAAG,SAAAA,CAAA;IAIpB,IAAID,UAAU,IAAI,CAACH,MAAM,CAACK,MAAM,IAAI,CAACJ,MAAM,EAAE;MAC3CR,UAAU,CAACa,QAAQ,EAAE;;EAEzB,CAAC;EAGD,IAAMC,SAAS,GAAG,SAAAA,CAACC,KAAQ;IAAK,OAACP,MAAM,GAAGN,UAAU,GAAGc,UAAU,CAACD,KAAK,CAAC,GAAGR,MAAM,CAACU,IAAI,CAACF,KAAK,CAAC;EAA7D,CAA8D;EAE9F,IAAMC,UAAU,GAAG,SAAAA,CAACD,KAAQ;IAI1BX,MAAM,IAAIJ,UAAU,CAACkB,IAAI,CAACH,KAAY,CAAC;IAIvCP,MAAM,EAAE;IAKR,IAAIW,aAAa,GAAG,KAAK;IAGzBxB,SAAS,CAACM,OAAO,CAACc,KAAK,EAAEN,KAAK,EAAE,CAAC,CAAC,CAACW,SAAS,CAC1CvB,wBAAwB,CACtBG,UAAU,EACV,UAACqB,UAAU;MAGTlB,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAGkB,UAAU,CAAC;MAE1B,IAAIjB,MAAM,EAAE;QAGVU,SAAS,CAACO,UAAiB,CAAC;OAC7B,MAAM;QAELrB,UAAU,CAACkB,IAAI,CAACG,UAAU,CAAC;;IAE/B,CAAC,EACD;MAGEF,aAAa,GAAG,IAAI;IACtB,CAAC,EAEDG,SAAS,EACT;MAIE,IAAIH,aAAa,EAAE;QAKjB,IAAI;UAIFX,MAAM,EAAE;;YAMN,IAAMe,aAAa,GAAGhB,MAAM,CAACiB,KAAK,EAAG;YAIrC,IAAInB,iBAAiB,EAAE;cACrBT,eAAe,CAACI,UAAU,EAAEK,iBAAiB,EAAE;gBAAM,OAAAW,UAAU,CAACO,aAAa,CAAC;cAAzB,CAAyB,CAAC;aAChF,MAAM;cACLP,UAAU,CAACO,aAAa,CAAC;;;UAR7B,OAAOhB,MAAM,CAACK,MAAM,IAAIJ,MAAM,GAAGN,UAAU;;;UAY3CS,aAAa,EAAE;SAChB,CAAC,OAAOc,GAAG,EAAE;UACZzB,UAAU,CAAC0B,KAAK,CAACD,GAAG,CAAC;;;IAG3B,CAAC,CACF,CACF;EACH,CAAC;EAGD1B,MAAM,CAACqB,SAAS,CACdvB,wBAAwB,CAACG,UAAU,EAAEc,SAAS,EAAE;IAE9CJ,UAAU,GAAG,IAAI;IACjBC,aAAa,EAAE;EACjB,CAAC,CAAC,CACH;EAID,OAAO;IACLL,mBAAmB,aAAnBA,mBAAmB,uBAAnBA,mBAAmB,EAAI;EACzB,CAAC;AACH"},"metadata":{},"sourceType":"module","externalDependencies":[]}